{
  "name": "eltex_3_state",
  "nodes": [
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -896,
        -1392
      ],
      "id": "9a6e71af-fafe-4119-a008-4656c49513ed",
      "name": "When clicking â€˜Execute workflowâ€™"
    },
    {
      "parameters": {
        "tableId": "eltex_history",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "message",
              "fieldValue": "=ðŸŒµÐ’ÐÐ˜ÐœÐÐÐ˜Ð•!\nÐÐ° ÑÐ°Ð¹Ñ‚Ðµ eltex-co.ru\nÑ‚Ð¾Ð²Ð°Ñ€ {{ $('get_state_old_new3').item.json.product_name }}\n{{ $('get_state_old_new3').item.json.product_url }}\nÐ¸Ð·Ð¼ÐµÐ½Ð¸Ð» ÑÑ‚Ð°Ñ‚ÑƒÑ Ð½Ð° âœ…{{ $('get_state_old_new3').item.json.current_status_new }}"
            },
            {
              "fieldId": "created_at",
              "fieldValue": "={{ $now.format('yyyy-MM-dd') }}"
            },
            {
              "fieldId": "workflow",
              "fieldValue": "eltex_state"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        2064,
        -992
      ],
      "id": "2cc9ced5-1f19-49a2-87da-97fa2456eb6b",
      "name": "Create a row1",
      "credentials": {
        "supabaseApi": {
          "id": " ",
          "name": "{{SUPABASE_CRED}}"
        }
      }
    },
    {
      "parameters": {
        "chatId": "{{ADMIN_CHAT_ID}}",
        "text": "=ðŸŒµÐ’ÐÐ˜ÐœÐÐÐ˜Ð•!\nÐÐ° ÑÐ°Ð¹Ñ‚Ðµ eltex-co.ru\nÑ‚Ð¾Ð²Ð°Ñ€ {{ $json.product_name }}\n{{ $json.product_url }}\nÐ¸Ð·Ð¼ÐµÐ½Ð¸Ð» ÑÑ‚Ð°Ñ‚ÑƒÑ Ð½Ð° âœ…{{ $json.current_status_new }}",
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1856,
        -992
      ],
      "id": "74e5a473-c858-4250-8e27-b43c4dd749a9",
      "name": "Send a text message",
      "webhookId": " ",
      "credentials": {
        "telegramApi": {
          "id": " ",
          "name": "{{TELEGRAM_CRED}}"
        }
      }
    },
    {
      "parameters": {
        "url": "=https://api.prod.eltex-co.ru/api/catalog/goods?filter[id]={{ $json.product_id_list }}",
        "options": {
          "allowUnauthorizedCerts": true
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -560,
        -1120
      ],
      "id": "46c3ac4a-ddb7-47a2-acd7-64b40a0b0d1c",
      "name": "HTTP Request1"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "6fd7df36-4b26-4342-8ab7-72358b8ea7ff",
              "name": "product_id",
              "value": "={{ $json.product_id }}",
              "type": "number"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -416,
        -1632
      ],
      "id": "06450fa8-98d7-4f21-a062-bec1b24e0958",
      "name": "Edit Fields3"
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "eltex_razdely_tovary",
        "returnAll": true,
        "matchType": "allFilters"
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -608,
        -1632
      ],
      "id": "d93aa5ce-7417-438d-a7c6-3778b2950a61",
      "name": "Get many rows1",
      "alwaysOutputData": false,
      "credentials": {
        "supabaseApi": {
          "id": " ",
          "name": "{{SUPABASE_CRED}}"
        }
      }
    },
    {
      "parameters": {
        "compare": "={{ $json.product_id }}",
        "options": {}
      },
      "type": "n8n-nodes-base.removeDuplicates",
      "typeVersion": 2,
      "position": [
        -240,
        -1632
      ],
      "id": "4efa11ee-2e07-4062-a870-b1d39f45c199",
      "name": "Remove Duplicates"
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "product_id"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        -384,
        -1408
      ],
      "id": "91873ca5-888d-4496-9966-26626e78a516",
      "name": "Aggregate"
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "eltex_razdely_tovary",
        "filters": {
          "conditions": [
            {
              "keyName": "id",
              "condition": "eq",
              "keyValue": "={{ $json.id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "current_status",
              "fieldValue": "={{ $json.current_status_new }}"
            },
            {
              "fieldId": "currient_state_state"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        2720,
        -1280
      ],
      "id": "fe63230f-b737-4d27-a3c1-2cffb52e0cc2",
      "name": "Update a row1",
      "credentials": {
        "supabaseApi": {
          "id": " ",
          "name": "{{SUPABASE_CRED}}"
        }
      }
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "triggerAtHour": 9,
              "triggerAtMinute": 20
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.3,
      "position": [
        -896,
        -1632
      ],
      "id": "1cdf0b0f-c428-4ba7-8dfa-cfba1a874825",
      "name": "Schedule Trigger"
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "eltex_razdely_tovary",
        "filters": {
          "conditions": [
            {
              "keyName": "product_id",
              "condition": "eq",
              "keyValue": "={{ $json.product_id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "currient_state_state",
              "fieldValue": "=new"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        816,
        -592
      ],
      "id": "aaf8ad8e-315c-4410-9e7f-6618f5caf46f",
      "name": "Update a row3",
      "credentials": {
        "supabaseApi": {
          "id": " ",
          "name": "{{SUPABASE_CRED}}"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        816,
        -400
      ],
      "id": "510c26ce-9b68-4a7f-aa92-c7767939af42",
      "name": "No Operation, do nothing2"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        176,
        -592
      ],
      "id": "80ad7c35-246e-4dd4-a046-06f0e744695c",
      "name": "Loop Over Items7"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "8ef8caf1-797d-4465-b491-459cb8212045",
              "leftValue": "={{ $json.current_status_old }}",
              "rightValue": "={{ $json.current_status_new }}",
              "operator": {
                "type": "string",
                "operation": "notEquals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        592,
        -576
      ],
      "id": "30fd3cfa-8b9b-4adc-a1b1-cb09e90343d7",
      "name": "If3"
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "eltex_razdely_tovary",
        "filters": {
          "conditions": [
            {
              "keyName": "product_id",
              "condition": "eq",
              "keyValue": "={{ $json.product_id }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "current_status_new",
              "fieldValue": "={{ $json.current_status_new }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        -112,
        -880
      ],
      "id": "3f9a5c4b-6795-41b4-8c62-846336cadbf3",
      "name": "paste_state_new",
      "credentials": {
        "supabaseApi": {
          "id": " ",
          "name": "{{SUPABASE_CRED}}"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c9857f18-f131-429f-b389-36c5fbc0e111",
              "name": "product_id",
              "value": "={{ $json.product_id }}",
              "type": "number"
            },
            {
              "id": "069562f3-f371-4d7d-bd44-1f6a2ae9e8a9",
              "name": "current_status_old",
              "value": "={{ $json.current_status }}",
              "type": "string"
            },
            {
              "id": "fb678556-d2cb-4c28-83e2-366fddfe6f90",
              "name": "current_status_new",
              "value": "={{ $json.current_status_new }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        128,
        -880
      ],
      "id": "ccb9e273-36f6-4809-9c63-5da220c3a16b",
      "name": "get_state_old_new"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c9857f18-f131-429f-b389-36c5fbc0e111",
              "name": "product_id",
              "value": "={{ $json.product_id }}",
              "type": "number"
            },
            {
              "id": "069562f3-f371-4d7d-bd44-1f6a2ae9e8a9",
              "name": "current_status_old",
              "value": "={{ $json.current_status_old }}",
              "type": "string"
            },
            {
              "id": "fb678556-d2cb-4c28-83e2-366fddfe6f90",
              "name": "current_status_new",
              "value": "={{ $json.current_status_new }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        400,
        -576
      ],
      "id": "00df4810-5329-40a3-8556-13188f051607",
      "name": "get_state_old_new1"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        432,
        -1264
      ],
      "id": "5dbd0db8-02fe-4091-a7a9-5cc251fe2a0d",
      "name": "Aggregate3"
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "eltex_razdely_tovary",
        "filters": {
          "conditions": [
            {
              "keyName": "currient_state_state",
              "condition": "eq",
              "keyValue": "=new"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        624,
        -1264
      ],
      "id": "cf61268b-e19e-4fb2-8d7d-e9f2c56f3524",
      "name": "Get many rows2",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": " ",
          "name": "{{SUPABASE_CRED}}"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c9857f18-f131-429f-b389-36c5fbc0e111",
              "name": "product_id",
              "value": "={{ $json.product_id }}",
              "type": "number"
            },
            {
              "id": "069562f3-f371-4d7d-bd44-1f6a2ae9e8a9",
              "name": "current_status_old",
              "value": "={{ $json.current_status }}",
              "type": "string"
            },
            {
              "id": "fb678556-d2cb-4c28-83e2-366fddfe6f90",
              "name": "current_status_new",
              "value": "={{ $json.current_status_new }}",
              "type": "string"
            },
            {
              "id": "b3d5fec9-bd06-4c36-90f8-e54a18205e8e",
              "name": "product_url",
              "value": "={{ $json.product_url }}",
              "type": "string"
            },
            {
              "id": "d9d36f6d-746e-4115-a17d-50734c93c3f8",
              "name": "product_name",
              "value": "={{ $json.product_name }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1120,
        -1280
      ],
      "id": "3ca2377c-47dc-44d1-873f-505f7e8d5443",
      "name": "get_state_old_new2"
    },
    {
      "parameters": {
        "compare": "=product_id",
        "options": {}
      },
      "type": "n8n-nodes-base.removeDuplicates",
      "typeVersion": 2,
      "position": [
        1360,
        -1280
      ],
      "id": "01a5dce9-e6d0-47ae-99fd-1dfb0d912c9a",
      "name": "Remove Duplicates1"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        1360,
        -1008
      ],
      "id": "f6bfff00-36d9-49d2-9a48-df1cb174bb01",
      "name": "Loop Over Items10"
    },
    {
      "parameters": {
        "chatId": "{{ADMIN_CHAT_ID}}",
        "text": "=ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÐ°Ð¹Ñ‚Ð° eltex-co Ð½Ð° ÑÑ‚Ð°Ñ‚ÑƒÑÑ‹ Ñ‚Ð¾Ð²Ð°Ñ€Ð¾Ð² Ð½Ðµ Ð²Ñ‹ÑÐ²Ð¸Ð»Ð° Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹ Ð½Ð° ÑÐµÐ³Ð¾Ð´Ð½Ñ!",
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        848,
        -1472
      ],
      "id": "527b9028-603e-45f7-8db1-e7c2452c9cca",
      "name": "ÐžÑ‚Ñ‡ÐµÑ‚ Ð½Ðµ Ð½Ð°ÑˆÐµÐ» Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹!1",
      "webhookId": " ",
      "notesInFlow": true,
      "credentials": {
        "telegramApi": {
          "id": " ",
          "name": "{{TELEGRAM_CRED}}"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "18956c1e-a4b2-4dae-82c7-d08fd019133e",
              "leftValue": "={{ $json.id }}",
              "rightValue": "",
              "operator": {
                "type": "number",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        864,
        -1264
      ],
      "id": "18c94b2c-881d-4214-a45a-11f8edae9ff7",
      "name": "If2",
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c9857f18-f131-429f-b389-36c5fbc0e111",
              "name": "product_id",
              "value": "={{ $json.product_id }}",
              "type": "number"
            },
            {
              "id": "069562f3-f371-4d7d-bd44-1f6a2ae9e8a9",
              "name": "current_status_old",
              "value": "={{ $json.current_status_old }}",
              "type": "string"
            },
            {
              "id": "fb678556-d2cb-4c28-83e2-366fddfe6f90",
              "name": "current_status_new",
              "value": "={{ $json.current_status_new }}",
              "type": "string"
            },
            {
              "id": "b3d5fec9-bd06-4c36-90f8-e54a18205e8e",
              "name": "product_url",
              "value": "={{ $json.product_url }}",
              "type": "string"
            },
            {
              "id": "d9d36f6d-746e-4115-a17d-50734c93c3f8",
              "name": "product_name",
              "value": "={{ $json.product_name }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1616,
        -992
      ],
      "id": "85b06512-6df8-4b70-85ac-b27903234cac",
      "name": "get_state_old_new3"
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        1744,
        -1600
      ],
      "id": "11fd1f17-a3ad-4e6f-8a8b-652fde8d48ce",
      "name": "Aggregate4"
    },
    {
      "parameters": {
        "operation": "getAll",
        "tableId": "eltex_razdely_tovary",
        "returnAll": true
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1968,
        -1600
      ],
      "id": "cff8396b-055e-4437-8c71-7f5020ca5545",
      "name": "Get many rows",
      "credentials": {
        "supabaseApi": {
          "id": " ",
          "name": "{{SUPABASE_CRED}}"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "fb678556-d2cb-4c28-83e2-366fddfe6f90",
              "name": "current_status_new",
              "value": "={{ $json.current_status_new }}",
              "type": "string"
            },
            {
              "id": "84116490-d6dd-41c8-adce-6d5c796c2c2f",
              "name": "id",
              "value": "={{ $json.id }}",
              "type": "number"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2192,
        -1600
      ],
      "id": "f66e4154-5674-42d1-800c-7d08ab1da4d9",
      "name": "get_state_old_new4"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "fb678556-d2cb-4c28-83e2-366fddfe6f90",
              "name": "current_status_new",
              "value": "={{ $json.current_status_new }}",
              "type": "string"
            },
            {
              "id": "84116490-d6dd-41c8-adce-6d5c796c2c2f",
              "name": "id",
              "value": "={{ $json.id }}",
              "type": "number"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        2496,
        -1280
      ],
      "id": "d6f0329f-bd9f-4b89-a718-27074188493c",
      "name": "get_state_old_new5"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        2208,
        -1296
      ],
      "id": "69dc307c-d3df-42fa-b500-d20a463edd18",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "chatId": "{{ADMIN_CHAT_ID}}",
        "text": "=ðŸŒµÐ’ÐÐ˜ÐœÐÐÐ˜Ð•!\nÐÐ° ÑÐ°Ð¹Ñ‚Ðµ eltex-co.ru\nÑ‚Ð¾Ð²Ð°Ñ€ {{ $json.product_name }}\n{{ $json.product_url }}\nÐ¸Ð·Ð¼ÐµÐ½Ð¸Ð» ÑÑ‚Ð°Ñ‚ÑƒÑ Ð½Ð° âœ…{{ $json.current_status_new }}",
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "HTML"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2816,
        -1616
      ],
      "id": "ab13513b-b576-4ca2-a839-9ee5c64218be",
      "name": "Send a text message1",
      "webhookId": "87591352-0773-4728-bd5f-cdc9500190e3",
      "credentials": {
        "telegramApi": {
          "id": " ",
          "name": "{{TELEGRAM_CRED}}"
        }
      }
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        2560,
        -1616
      ],
      "id": "0fb08683-5ade-4f21-9cbe-add87372b6b6",
      "name": "Aggregate5"
    },
    {
      "parameters": {
        "content": "## Ð·Ð°Ð±Ð¸Ñ€Ð°ÐµÑ‚ Ð¾Ñ‚ eltez-co Ð²ÑÐµ ÑÑ‚Ð°Ñ‚ÑƒÑÑ‹ ÑÑ€Ð°Ð·Ñƒ",
        "height": 80,
        "width": 352,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -352,
        -1104
      ],
      "typeVersion": 1,
      "id": "ccd9c868-e3b2-44a3-aeff-080d18cb0b17",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "## ÑÑ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ ÑÐ¾ Ð²Ñ‡ÐµÑ€Ð°ÑˆÐ½Ð¸Ð¼ ÐµÑÐ»Ð¸ Ð½Ð¾Ð²Ñ‹Ð¹ - Ð¼ÐµÑ‚ÐºÐ° new",
        "height": 80,
        "width": 336,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        368,
        -400
      ],
      "typeVersion": 1,
      "id": "6ca5fe4f-7dcc-4bb1-bbce-4010452a230c",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "## Ð±ÐµÑ€ÐµÑ‚ Ð²ÑÐµ new Ð¸ Ð¿Ð¸ÑˆÐµÑ‚ Ð² Ñ‚Ð³",
        "height": 80,
        "width": 416,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1056,
        -1408
      ],
      "typeVersion": 1,
      "id": "ac3ab8f3-7846-4404-b39e-66fb89572dbc",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "content": "## Ð¼ÐµÐ½ÑÐµÑ‚ ÑÑ‚Ð°Ñ€Ñ‹Ðµ ÑÑ‚Ð°Ñ‚ÑƒÑÑ‹ Ð½Ð° Ð½Ð¾Ð²Ñ‹Ðµ Ð¸ Ð¾Ñ‡Ð¸Ñ‰Ð°ÐµÑ‚ Ð¼ÐµÑ‚ÐºÐ¸",
        "height": 80,
        "width": 416,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2320,
        -1056
      ],
      "typeVersion": 1,
      "id": "065532f5-c716-4232-b260-503e636f683c",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "70a7e9c5-410e-4676-8b71-9b0477528f79",
              "name": "batch",
              "value": "={{ $input.all()[0] }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1056,
        -400
      ],
      "id": "ca08b540-d5e7-4ae6-813d-b624de2619d9",
      "name": "Edit Fields6"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "888862cf-68a4-4f5a-b134-315d8444b4ed",
              "name": "product_id_list",
              "value": "={{ $input.all().flatMap(item => item.json.product_id || []).filter(id => id).join(',') }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -160,
        -1408
      ],
      "id": "3e47568b-4248-471d-8bb0-f113b6a380fe",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "86d3c0b3-fa76-4a76-9e74-3d4d1adf969b",
              "name": "product_id",
              "value": "={{ $json.id }}",
              "type": "string"
            },
            {
              "id": "6cb68f4c-3602-4991-aca2-95f0bdf1218e",
              "name": "current_status_new",
              "value": "={{ $json.lifecycle[0].name }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -352,
        -880
      ],
      "id": "51429886-ec74-4a76-9537-20bfcbe5a032",
      "name": "state new"
    },
    {
      "parameters": {
        "fieldToSplitOut": "data",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        -560,
        -880
      ],
      "id": "76c8d194-61d8-44bb-9082-7ce162b3af8a",
      "name": "Split Out"
    }
  ],
  "pinData": {},
  "connections": {
    "When clicking â€˜Execute workflowâ€™": {
      "main": [
        [
          {
            "node": "Get many rows1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create a row1": {
      "main": [
        [
          {
            "node": "Loop Over Items10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a text message": {
      "main": [
        [
          {
            "node": "Create a row1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request1": {
      "main": [
        [
          {
            "node": "Split Out",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields3": {
      "main": [
        [
          {
            "node": "Remove Duplicates",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get many rows1": {
      "main": [
        [
          {
            "node": "Edit Fields3",
            "type": "main",
            "index": 0
          }
        ],
        []
      ]
    },
    "Remove Duplicates": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update a row1": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "Get many rows1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update a row3": {
      "main": [
        [
          {
            "node": "Edit Fields6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "No Operation, do nothing2": {
      "main": [
        [
          {
            "node": "Edit Fields6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items7": {
      "main": [
        [
          {
            "node": "Aggregate3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "get_state_old_new1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If3": {
      "main": [
        [
          {
            "node": "Update a row3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "paste_state_new": {
      "main": [
        [
          {
            "node": "get_state_old_new",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get_state_old_new": {
      "main": [
        [
          {
            "node": "Loop Over Items7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get_state_old_new1": {
      "main": [
        [
          {
            "node": "If3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate3": {
      "main": [
        [
          {
            "node": "Get many rows2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get many rows2": {
      "main": [
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get_state_old_new2": {
      "main": [
        [
          {
            "node": "Remove Duplicates1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [
          {
            "node": "get_state_old_new2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ÐžÑ‚Ñ‡ÐµÑ‚ Ð½Ðµ Ð½Ð°ÑˆÐµÐ» Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹!1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Remove Duplicates1": {
      "main": [
        [
          {
            "node": "Loop Over Items10",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items10": {
      "main": [
        [
          {
            "node": "Aggregate4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "get_state_old_new3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get_state_old_new3": {
      "main": [
        [
          {
            "node": "Send a text message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate4": {
      "main": [
        [
          {
            "node": "Get many rows",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get many rows": {
      "main": [
        [
          {
            "node": "get_state_old_new4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get_state_old_new4": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get_state_old_new5": {
      "main": [
        [
          {
            "node": "Update a row1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [
          {
            "node": "Aggregate5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "get_state_old_new5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate5": {
      "main": [
        [
          {
            "node": "Send a text message1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields6": {
      "main": [
        [
          {
            "node": "Loop Over Items7",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "HTTP Request1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "state new": {
      "main": [
        [
          {
            "node": "paste_state_new",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out": {
      "main": [
        [
          {
            "node": "state new",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false,
    "timeSavedMode": "fixed",
    "timezone": "Asia/Novosibirsk",
    "callerPolicy": "workflowsFromSameOwner",
    "errorWorkflow": "xKkvhVVVcaXTXZnpI1-eh"
  },
  "versionId": "",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": " "
  },
  "id": "",
  "tags": [
    {
      "updatedAt": "2026-01-24T12:34:18.896Z",
      "createdAt": "2026-01-24T12:34:18.896Z",
      "id": "aH0tuK4KHlv7tkki",
      "name": "eltex"
    }
  ]
}